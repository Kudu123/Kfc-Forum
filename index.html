<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Work Update Tracker</title>
<!-- jsPDF & AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
  /* Reset & basics */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #eef2f3, #dfe9f3);
    margin: 0;
    color: #333;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Navbar */
  nav {
    background: #2980b9;
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    position: relative;
    z-index: 100;
  }

  /* Nav links container */
  .nav-links {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
    transition: max-height 0.35s ease-in-out, padding 0.3s ease-in-out;
  }

  /* Nav links style */
  nav a {
    color: white;
    text-decoration: none;
    font-weight: 700;
    cursor: pointer;
    padding: 8px 14px;
    white-space: nowrap;
    border-radius: 4px;
    user-select: none;
    transition: background-color 0.3s ease;
  }

  nav a:hover,
  nav a:focus {
    background-color: #1f6690;
    outline: none;
  }

  /* Hamburger menu */
  .hamburger {
    display: none;
    flex-direction: column;
    cursor: pointer;
    width: 28px;
    height: 22px;
    justify-content: space-between;
    z-index: 101;
  }

  .hamburger span {
    background: white;
    height: 3px;
    border-radius: 2px;
    transition: 0.3s ease;
  }

  /* Sections */
  section {
    padding: 20px;
    display: none;
    flex-grow: 1;
  }

  h2, h3 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
  }
  h2 {
    font-size: 1.75rem;
  }
  h3 {
    font-size: 1.3rem;
  }

  .form-container,
  .list-container {
    background: white;
    padding: 25px 20px;
    margin: 0 auto 30px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    max-width: 100%;
    max-width: 900px;
  }

  input, textarea, select, button {
    width: 100%;
    padding: 12px 14px;
    margin: 10px 0;
    font-size: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }
  input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: #2980b9;
    box-shadow: 0 0 5px #2980b9;
  }

  textarea {
    height: 90px;
    resize: vertical;
  }

  button {
    background: #2980b9;
    color: white;
    border: none;
    font-weight: 700;
    cursor: pointer;
    margin-top: 10px;
    white-space: nowrap;
    border-radius: 8px;
    transition: background-color 0.3s ease;
    min-height: 40px;
  }

  button:hover:not(:disabled),
  button:focus:not(:disabled) {
    background: #1f6690;
    outline: none;
  }

  button:disabled {
    background: #888;
    cursor: not-allowed;
  }

  .paid {
    background: #c8e6c9;
  }

  .unpaid {
    background: #ffcdd2;
  }

  .table-container {
    overflow-x: auto;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    table-layout: auto;
    font-size: 13px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px 10px;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
  }

  th {
    background: #2980b9;
    color: white;
    user-select: none;
  }

  /* Column widths */
  th:nth-child(1), td:nth-child(1) { width: 35px; }
  th:nth-child(2), td:nth-child(2) { width: 90px; }
  th:nth-child(3), td:nth-child(3) { width: 90px; }
  th:nth-child(4), td:nth-child(4) { width: 110px; }
  th:nth-child(5), td:nth-child(5) { width: 90px; }
  th:nth-child(6), td:nth-child(6) { width: 120px; } /* Changed from 180px to fit place */
  th:nth-child(7), td:nth-child(7) { width: 180px; } /* Names column moved here */
  th:nth-child(8), td:nth-child(8) { width: 110px; }
  th:nth-child(9), td:nth-child(9) { width: 110px; }
  th:nth-child(10), td:nth-child(10) { width: 80px; }
  th:nth-child(11), td:nth-child(11) { width: 120px; }

  .action-buttons {
    display: flex;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
  }

  .action-buttons button {
    font-size: 12px;
    padding: 6px 9px;
    min-width: 75px;
  }

  .list-controls {
    margin-bottom: 15px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .list-controls button {
    width: auto;
    padding: 10px 16px;
    font-weight: 700;
    border-radius: 8px;
  }

  /* Responsive */

  @media (max-width: 900px) {
    section {
      padding: 15px 10px;
    }
    .form-container,
    .list-container {
      padding: 20px 15px;
      max-width: 100%;
    }
    input, textarea, select, button {
      font-size: 14px;
      padding: 10px 12px;
    }
    h2 {
      font-size: 1.5rem;
    }
    h3 {
      font-size: 1.1rem;
    }
  }

  @media (max-width: 600px) {
    .hamburger {
      display: flex;
    }
    .nav-links {
      display: none;
      flex-direction: column;
      width: 100%;
      margin-top: 10px;
      background-color: #2980b9;
      border-radius: 8px;
      padding: 0;
      position: absolute;
      top: 48px;
      left: 0;
      z-index: 99;
      box-shadow: 0 6px 10px rgba(0,0,0,0.15);
      max-height: 0;
      overflow: hidden;
    }
    .nav-links.show {
      display: flex;
      max-height: 500px;
      padding: 10px 0;
      transition: max-height 0.35s ease-in-out, padding 0.3s ease-in-out;
    }
    .nav-links a {
      padding: 14px 20px;
      margin: 0;
      border-top: 1px solid rgba(255,255,255,0.3);
      user-select: none;
      font-size: 16px;
      font-weight: 700;
    }
    .nav-links a:first-child {
      border-top: none;
    }
    nav {
      justify-content: space-between;
      position: relative;
    }
    input, textarea, select, button {
      font-size: 15px;
    }
    h2 {
      font-size: 1.4rem;
    }
    h3 {
      font-size: 1.2rem;
    }
  }

  @media (max-width: 400px) {
    input, textarea, select, button {
      font-size: 14px;
      padding: 8px 10px;
    }
    h2 {
      font-size: 1.25rem;
    }
    h3 {
      font-size: 1.1rem;
    }
    table {
      width: 100%;
      font-size: 12px;
    }
    .action-buttons button {
      min-width: 65px;
      font-size: 11px;
      padding: 5px 7px;
    }
    .list-controls button {
      padding: 8px 14px;
      font-size: 14px;
    }
  }
</style>
</head>
<body>

<nav>
  <div class="hamburger" id="hamburger" aria-label="Toggle menu" tabindex="0" role="button" aria-expanded="false" aria-controls="navLinks">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <div class="nav-links" id="navLinks" role="menu">
    <a role="menuitem" tabindex="-1" onclick="showSection('addWorkSection'); toggleMenu()">Add Work</a>
    <a role="menuitem" tabindex="-1" onclick="showSection('workListSection'); toggleMenu()">Work List</a>
  </div>
</nav>

<section id="addWorkSection">
  <h2>üìã Work Update Tracker</h2>
  <div class="form-container" role="form" aria-label="Work Update Form">
    <h3 id="formTitle">Add Work</h3>

    <select id="workType" aria-label="Work Type">
      <option value="Juice">Juice</option>
      <option value="Catering">Catering</option>
    </select>

    <input type="text" id="place" placeholder="Place" aria-required="true" />

    <input type="number" id="totalWorkers" placeholder="Total Workers" oninput="updateSalary()" aria-required="true" min="0" />
    <textarea id="workerNames" placeholder="Enter each worker name on a new line" aria-required="true"></textarea>
    <input type="number" id="salaryPerWorker" placeholder="Salary Per Worker" oninput="updateSalary()" aria-required="true" min="0" step="0.01" />
    <input type="number" id="salary" placeholder="Total Salary" readonly aria-readonly="true" />
    <textarea id="description" placeholder="Description"></textarea>
    <select id="status" aria-label="Payment Status">
      <option value="unpaid">Unpaid</option>
      <option value="paid">Paid</option>
    </select>
    <button onclick="saveWork()" id="saveBtn">‚ûï Add Work</button>
  </div>
</section>

<section id="workListSection">
  <div class="list-container" style="width: auto;">
    <h3>Work List</h3>
    <div class="list-controls">
      <button onclick="editSelected()" id="editSelectedBtn" disabled>‚úèÔ∏è Edit Selected</button>
      <button onclick="deleteSelected()">üóëÔ∏è Delete Selected</button>
      <button onclick="downloadPDF()">üìÑ Download Report</button>
    </div>
    <div class="table-container" tabindex="0" aria-label="Scrollable table container">
      <table id="workTable" aria-label="Work list table" role="grid">
        <thead>
          <tr>
            <th scope="col"><input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)" aria-label="Select all rows" /></th>
            <th scope="col">Work Date</th>
            <th scope="col">Paid Date</th>
            <th scope="col">Work Type</th>
            <th scope="col">Place</th>
            <th scope="col">Total Workers</th>
            <th scope="col">Names</th>
            <th scope="col">Salary Per Worker</th>
            <th scope="col">Total Salary</th>
            <th scope="col">Description</th>
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</section>

<script>
  // Hamburger menu toggle logic
  const hamburger = document.getElementById("hamburger");
  const navLinks = document.getElementById("navLinks");

  function toggleMenu() {
    navLinks.classList.toggle("show");
    const expanded = navLinks.classList.contains("show");
    hamburger.setAttribute("aria-expanded", expanded);
  }

  hamburger.addEventListener("click", toggleMenu);

  hamburger.addEventListener("keydown", e => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      toggleMenu();
    }
  });

  // Work data management
  let workList = JSON.parse(localStorage.getItem("workData")) || [];
  let editIndex = null;

  function saveData() {
    localStorage.setItem("workData", JSON.stringify(workList));
  }

  function updateSalary() {
    const totalWorkers = parseInt(document.getElementById("totalWorkers").value) || 0;
    const salaryPerWorker = parseFloat(document.getElementById("salaryPerWorker").value) || 0;
    document.getElementById("salary").value = (totalWorkers * salaryPerWorker).toFixed(2);
  }

  function saveWork() {
    const workType = document.getElementById("workType").value.trim();
    const place = document.getElementById("place").value.trim();
    const totalWorkers = document.getElementById("totalWorkers").value;
    const workerNames = document.getElementById("workerNames").value
      .split("\n")
      .map(name => name.trim())
      .filter(name => name !== "")
      .join(", ");
    const salaryPerWorker = document.getElementById("salaryPerWorker").value;
    const salary = document.getElementById("salary").value;
    const description = document.getElementById("description").value.trim();
    const status = document.getElementById("status").value;

    if (!workType || !place || !totalWorkers || !workerNames || !salaryPerWorker) {
      alert("Please fill all required fields.");
      return;
    }

    if (editIndex !== null) {
      workList[editIndex] = {
        ...workList[editIndex],
        type: workType,
        place,
        totalWorkers,
        names: workerNames,
        salaryPerWorker,
        salary,
        description,
        status,
        paidDate: status === "paid" ? new Date().toLocaleDateString() : workList[editIndex].paidDate
      };
      editIndex = null;
      document.getElementById("formTitle").innerText = "Add Work";
      document.getElementById("saveBtn").innerText = "‚ûï Add Work";
    } else {
      workList.push({
        workDate: new Date().toLocaleDateString(),
        paidDate: status === "paid" ? new Date().toLocaleDateString() : "",
        type: workType,
        place,
        totalWorkers,
        names: workerNames,
        salaryPerWorker,
        salary,
        description,
        status
      });
    }

    saveData();
    displayWorks();
    clearForm();
    showSection("workListSection");
  }

  function editWork(index) {
    const work = workList[index];
    document.getElementById("workType").value = work.type;
    document.getElementById("place").value = work.place || "";
    document.getElementById("totalWorkers").value = work.totalWorkers;
    document.getElementById("workerNames").value = work.names.split(", ").join("\n");
    document.getElementById("salaryPerWorker").value = work.salaryPerWorker;
    document.getElementById("salary").value = work.salary;
    document.getElementById("description").value = work.description;
    document.getElementById("status").value = work.status;
    document.getElementById("formTitle").innerText = "Edit Work";
    document.getElementById("saveBtn").innerText = "üíæ Update Work";
    editIndex = index;
    showSection("addWorkSection");
  }

  function deleteWork(index) {
    if (confirm("Are you sure you want to delete this work?")) {
      workList.splice(index, 1);
      saveData();
      displayWorks();
    }
  }

  function deleteSelected() {
    const checkboxes = document.querySelectorAll(".rowSelect:checked");
    if (checkboxes.length === 0) {
      alert("No rows selected.");
      return;
    }
    if (!confirm("Are you sure you want to delete selected rows?")) return;
    const indexes = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
    workList = workList.filter((_, idx) => !indexes.includes(idx));
    saveData();
    displayWorks();
  }

  function markAsPaid(index) {
    if (workList[index].status === "unpaid") {
      workList[index].status = "paid";
      workList[index].paidDate = new Date().toLocaleDateString();
      saveData();
      displayWorks();
    }
  }

  function displayWorks() {
    let tbody = document.querySelector("#workTable tbody");
    tbody.innerHTML = "";
    workList.forEach((work, index) => {
      let row = `<tr class="${work.status}">
          <td><input type="checkbox" class="rowSelect" data-index="${index}" onchange="onRowSelectChange()" aria-label="Select row ${index + 1}"></td>
          <td title="${work.workDate}">${work.workDate}</td>
          <td title="${work.paidDate || '-'}">${work.paidDate || "-"}</td>
          <td title="${work.type}">${work.type}</td>
          <td title="${work.place}">${work.place}</td>
          <td title="${work.totalWorkers}">${work.totalWorkers}</td>
          <td title="${work.names}">${work.names}</td>
          <td title="${work.salaryPerWorker}">${work.salaryPerWorker}</td>
          <td title="${work.salary}">${work.salary}</td>
          <td title="${work.description}">${work.description}</td>
          <td title="${work.status}">${work.status}</td>
          <td class="action-buttons">
            ${work.status === "unpaid"
              ? `<button onclick="markAsPaid(${index})" aria-label="Mark work ${index + 1} as paid">Mark as Paid</button>`
              : `<button disabled aria-label="Work ${index + 1} is paid">Paid</button>`
            }
          </td>
        </tr>`;
      tbody.innerHTML += row;
    });
    document.getElementById("selectAll").checked = false;
    updateSelectionButtons();
  }

  function clearForm() {
    document.querySelectorAll("#workType, #place, #totalWorkers, #workerNames, #salaryPerWorker, #salary, #description")
      .forEach(input => input.value = "");
    document.getElementById("status").value = "unpaid";
  }

  function showSection(sectionId) {
    document.getElementById("addWorkSection").style.display = "none";
    document.getElementById("workListSection").style.display = "none";
    document.getElementById(sectionId).style.display = "block";
  }

  function toggleSelectAll(source) {
    const checkboxes = document.querySelectorAll(".rowSelect");
    checkboxes.forEach(cb => {
      cb.checked = source.checked;
    });
    updateSelectionButtons();
  }

  function onRowSelectChange() {
    const selectAll = document.getElementById("selectAll");
    const checkboxes = document.querySelectorAll(".rowSelect");
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    const someChecked = Array.from(checkboxes).some(cb => cb.checked);

    selectAll.checked = allChecked;
    selectAll.indeterminate = !allChecked && someChecked;

    updateSelectionButtons();
  }

  function updateSelectionButtons() {
    const checkboxes = document.querySelectorAll(".rowSelect:checked");
    const editBtn = document.getElementById("editSelectedBtn");
    editBtn.disabled = checkboxes.length !== 1;
  }

  function editSelected() {
    const checkboxes = document.querySelectorAll(".rowSelect:checked");
    if (checkboxes.length !== 1) {
      alert("Please select exactly one row to edit.");
      return;
    }
    const index = parseInt(checkboxes[0].dataset.index);
    editWork(index);
  }

  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Work List Report", 14, 10);

    const tableData = workList.map(work => [
      work.workDate,
      work.paidDate || "-",
      work.type,
      work.place,
      work.totalWorkers,
      work.names,
      work.salaryPerWorker,
      work.salary,
      work.description,
      work.status
    ]);

    doc.autoTable({
      head: [["Work Date", "Paid Date", "Work Type", "Place", "Total Workers", "Names", "Salary/Worker", "Total Salary", "Description", "Status"]],
      body: tableData,
      startY: 20,
      theme: "grid"
    });

    doc.save("work_list_report.pdf");
  }

  // Init
  showSection("workListSection");
  displayWorks();
</script>

</body>
</html>
